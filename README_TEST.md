## フロントエンドテストについて説明

テストの実施方針を決めるためにテストの基本情報を以下にまとめる。

前提条件としてNuxt3でのプロジェクトを想定している。

## テストの粒度
よくあるテストの粒度として、単体テスト、統合テスト、E2Eテストがある。

### 単体テスト(ユニットテスト)

- **目的:**  
  各部品（関数やコンポーネント）が単体で正しく動作しているかを確認する。

- **テスト例:**  
  - コンポーネントのレンダリング結果が想定したとおりか  
    *(例: [スナップショットテスト](#スナップショットテスト)、[ビジュアルリグレッションテスト](#ビジュアルリグレッションテスト))*
  - メソッドが期待通りの結果を返すか
  - 特定のボタンをクリックした際に、意図したデータ更新が起きるか  

### 統合テスト(インテグレーションテスト)

- **目的:**  
  複数の部品（コンポーネント、ストア、API通信など）が連携して正しく機能するかを検証する。

- **テスト例:**  
  - ページや複数のコンポーネントが連携したレンダリング結果が想定したとおりか
    *(例: [スナップショットテスト](#スナップショットテスト)、[ビジュアルリグレッションテスト](#ビジュアルリグレッションテスト))*
  - ページがストアから正しいデータを受け取り、子コンポーネントに正しく渡しているか  
  - APIから取得したデータが画面に正しく表示されるか  
  - ページ間のデータ受け渡しがスムーズに行われるか

### E2E(End-to-End)テスト

- **目的:**  
  ユーザーが実際に操作するシナリオを再現し、アプリ全体が期待通りに動作するかをチェックする。

- **テスト例:**  
  - ユーザーがログイン、フォーム送信、ページ遷移を行った際に問題がないか  
  - 実際のブラウザ上で、各ページの表示や動作が正しいか  
  - リンクやボタンの動作がユーザーの期待通りか

---

## 今回どの粒度のテストに力を入れるか
**よくある考え方**
- テスティングピラミッド
  - ユニットテストに力を入れてテストを書こうとするテスト戦略
  - 単体部品のテストの網羅性に力を入れる

- テスティングトロフィー
  - 統合テストに力を入れてテストを書こうとするテスト戦略
  - 単体で意味をなさない機能、部品にに労力をかけすぎない
  - 実際のユースケースを想定したテストに力を入れる

- 参考 
  - https://rightcode.co.jp/blogs/40957
  - https://qiita.com/grhg/items/c42dbbf76ca9ae0dcadb


## ユニット・統合テスト向けツール

### Jest

- **メリット:**  
  - **実績豊富:** 長年使われているため、情報や事例がたくさんあり学びやすい  
  - **機能充実:** スナップショットテストやモックなど、多彩な機能が揃っている

- **デメリット:**  
  - **設定が複雑:** 特にViteとの連携設定がやや手間  
  - **実行速度:** Vitestなどと比べるとテストの実行が少し遅い場合がある

---

### Vitest

- **メリット:**  
  - **高速:** Nuxt3がViteベースなため、テスト実行が速い  
  - **シームレスな統合:** 開発環境との連携がスムーズ
  - **互換性が高い** Jestとの互換性が高く、基本的にJestでできることをテストできる。

- **デメリット:**  
  - **情報が少なめ:** Jestほどの実績やプラグインがまだ揃っていない  
  - **高度なケース:** 複雑な設定に関する情報が不足している場合がある


## E2E(End-to-End)テストツール

### Cypress

- **メリット:**  
  - **実行中の確認が容易:** テスト実行時にブラウザ上で動きを確認でき、デバッグしやすい  
  - **使いやすい:** 初心者でも取り組みやすく、情報やサンプルが豊富

- **デメリット:**  
  - **ウィンドウ/タブ制限:** 複数ウィンドウやタブを跨ぐテストには不向き  
  - **特殊環境の再現が難しい:** ネットワークの特殊条件などの再現に制限がある

---

### Playwright

- **メリット:**  
  - **クロスブラウザ対応:** Chromium、Firefox、WebKitなど、複数のブラウザでのテストが可能  
  - **複雑な操作にも対応:** 複数ウィンドウやタブの操作、モバイルシミュレーションもできる

- **デメリット:**  
  - **シンプルなUI:** デバッグや実行画面がCypressほど視覚的でない  
  - **コミュニティ規模:** サポートやサードパーティプラグインはCypressほど豊富ではない


### まとめ

### ユニット・統合テスト

「Nuxt3のViteベースの環境を考慮すると、Vitestの採用がおすすめです。既存のJestとの互換性があるため、移行もスムーズです。ただし、既にJestに精通しているメンバーが多い場合は、Jestの選択も検討してみましょう。」

### E2Eテスト

「ユーザーフローの再現やデバッグのしやすさを重視するならCypress、クロスブラウザや複雑な操作を重視するならPlaywrightがおすすめです。」


## 補足

### スナップショットテスト
  コンポーネントやページのレンダリング結果を文字列化して保存 → 差分を検出

  - メリット
    - 大まかな変更点を一括検知できる  
    - DOM 構造やロジック出力の“意図しない改変”を発見しやすい  
  - デメリット
    - 見た目(CSS の崩れ)までは検知できない


### ビジュアルリグレッションテスト
  ブラウザで表示する実際の画面をキャプチャし、前回の画像とピクセル単位で比較。
  - メリット
    - UI の崩れやデザイン変更を即座に可視化  
    - コンポーネント単位からページ全体まで、画像としての比較が可能
    - ヘッドレスブラウザ(ブラウザを実際に起動しない)での動作が検証できる
  - デメリット
    - キャプチャの設定や差分承認フローがやや面倒
